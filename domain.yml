version: "3.1"

intents:
  - greet
  - goodbye
  - affirm
  - deny
  - bot_challenge
  - inform
  - provide_names
  - inform_email
  - ask_availability
  #- inform_num_nights
  - supply_contact_info
  - ask_breakfast_price
  - inform_room_type
  - confirmation_by_email
  - confirmation_by_sms
  

actions:
  - validate_stay_form
  - validate_email_form
  - action_validate_email
  - action_check_rooms
  - action_validate_slot_mappings # to run single slot validation
  - validate_checkin_date
  - action_email_or_sms

entities:
  - email
  - name
  - num_guests
  - time
  - number
  - single_room
  - double_room
  - room_type
  - amount
  - contact_channel

responses:
  utter_greet:
  - text: "Hey! How are you?"



  utter_goodbye:
  - text: "Bye"

  utter_iamabot:
  - text: "I am a bot, powered by Rasa."

  utter_ask_first_name:
  - text: What is your first name?
  utter_ask_last_name:
  - text: What is your last name?
  utter_submit_name:
  - text: Thanks for providing your name.
  utter_name_values:
  - text: Thank you {first_name} {last_name} for providing your name!

# EMAIL
  utter_ask_email:
  - text: Can you please provide me your email address?
  utter_email:
  - text: Thank you for providing {email} as your preferred email address.
  utter_confirmationemail:
  - text: We have sent a confirmation email to {email}.
  utter_explain_email:
  - text: We need your email to contact you afterwards. Otherwise, we cannot help you with your request.
  utter_no_email:
  - text: Hmm, I'm not sure that {email} is a valid email, please make sure to include the full address ðŸ˜….

# Number of guests
  utter_ask_num_guests:
  - text: For how many people do you need accomodations?
  utter_num_guests:
  - text: I will check the availability for {num_guests} guests.  ## might result in unintended conversations

# Stay information
  utter_stay_form:
  - text: I will check the availability for {num_guests} guests from {checkin_date} to {checkout_date}.
  utter_ask_checkin_date:
  - text: Which date to you want to arrive at our hotel?
  utter_ask_checkout_date:
  - text: On which day do you expect to checkout?

# breakfast information
  utter_breakfast_price:
  - text: The price for the breakfast buffet is â‚¬ 19.00 per person.
  utter_ask_add_breakfast:
  - text: Do you want to add breakfast to your booking?

# confirmation details
  utter_confirmation_by_email:
  - text: We have sent you the confirmation by email.

  utter_confirmation_by_sms:
  - text: We have sent you the confirmation by SMS.


session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true

slots:
  first_name:
    type: text
    influence_conversation: true
    mappings:
    - type: from_text
      #intent: None
      conditions:
      - active_loop: name_form
        requested_slot: first_name
  last_name:
    type: text
    influence_conversation: true
    mappings:
    - type: from_text
      #intent: None # request_names
      conditions:
      - active_loop: name_form
        requested_slot: last_name

  email:
    type: text
    influence_conversation: true
    mappings:
    - type: custom 
    #- type: from_entity
      #entity: email  ### does this have to be custom?

  name:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: name

  num_guests:
    type: float ## "any" must be used in conjunction with custom slot mappings
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: number
      conditions:
      - active_loop: stay_form
        requested_slot: num_guests
  
  checkin_date_dummy: # only needed to grab information during the intent
    type: text 
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: time
      intent: ask_availability

  checkin_date:
    type: text 
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: time
      intent: ask_availability
      conditions:
      - active_loop: stay_form
        requested_slot: checkin_date
    - type: custom

  checkout_date:
    type: text 
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: time
      conditions:
        - active_loop: stay_form
          requested_slot: checkout_date

  num_nights:
    type: float ## "any" must be used in conjunction with custom slot mappings
    influence_conversation: true
    mappings:
    - type: custom
    #  entity: number
    #  intent: inform_num_nights

  contact_channel:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: contact_channel

forms:
  name_form:
    required_slots:
    - first_name
    - last_name

  email_form:
    required_slots:
    - email


  stay_form:
    required_slots:
    - num_guests
    - checkin_date
    - checkout_date